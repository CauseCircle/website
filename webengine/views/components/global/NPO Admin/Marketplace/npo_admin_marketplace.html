<style>
  .bg-navy {
    background-color: #131d45;
  }
  .btn-coral {
    background-color: #f97185;
    color: white;
  }
  .btn-coral:hover {
    background-color: #ff5a71;
    color: white;
  }
  .marketplace-card {
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
    height: 100%;
  }
  .featured-badge {
    color: #1ea8cf;
  }
  .category-badge {
    background-color: #f0f5f9;
    color: #131d45;
    font-size: 0.8rem;
    border-radius: 20px;
  }
  .dot-pattern {
    opacity: 0.2;
  }
  .carousel-control-prev,
  .carousel-control-next {
    width: 40px;
    height: 40px;
    background: white;
    border-radius: 50%;
    top: 50%;
    transform: translateY(-50%);
    opacity: 1;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }
  .carousel-control-prev {
    left: 5px;
  }
  .carousel-control-next {
    right: 5px;
  }
  .carousel-control-prev-icon,
  .carousel-control-next-icon {
    width: 20px;
    height: 20px;
    filter: invert(1) grayscale(100);
  }
  .carousel-item {
    padding: 0 10px;
  }
  .carousel-inner {
    padding: 20px 20px;
  }
  .overlap-section {
    margin-top: -110px;
    position: relative;
    z-index: 9;
  }
  .header-section {
    padding-bottom: 100px;
  }

  /* Search Bar */
  .search-bar {
    position: relative;
    display: flex;
    justify-content: center;
    padding: 20px 0;
    width: 100%;
    max-width: 720px;
  }

  .search-bar input {
    width: 100%;
    max-width: 720px;
    height: 66px;
    padding: 20px 44px 20px 24px;
    font-size: 16px;
    border: 1px solid #dfe1e7;
    border-radius: 10px;
  }

  .search-bar button {
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    border: none;
    background: none;
    cursor: pointer;
    color: #ccc;
  }

  .search-bar button:hover {
    color: #333;
  }

  #marketplace-header {
    background: linear-gradient(to bottom, white, #f7d7fe);
  }
  
  /* Categories Sidebar */
  .categories-list {
    list-style-type: none;
    padding-left: 0;
  }
  
  .categories-list li {
    padding: 10px 0;
    border-bottom: 1px solid #f0f0f0;
  }
  
  .categories-list li:last-child {
    border-bottom: none;
  }
  
  .categories-list a {
    color: #333;
    text-decoration: none;
    display: block;
    transition: color 0.2s;
  }
  
  .categories-list a:hover {
    color: #f97185;
  }
  
  .active-category {
    color: #f97185 !important;
    font-weight: 600;
    border-left: 3px solid #f97185;
    padding-left: 10px;
    margin-left: -13px;
  }
  
  /* Integration Cards */
  .integration-card {
    display: flex;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
    transition: transform 0.2s, box-shadow 0.2s;
    background-color: white;
  }
  
  .integration-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  }
  
  .integration-logo {
    width: 150px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    background-color: white;
    border-right: 1px solid #f0f0f0;
  }
  
  .integration-content {
    flex-grow: 1;
    padding: 20px;
    display: flex;
    flex-direction: column;
  }
  
  .integration-content h3 {
    font-size: 1.25rem;
    margin-bottom: 10px;
    font-weight: 600;
  }
  
  .integration-content p {
    color: #666;
    margin-bottom: 15px;
    font-size: 0.95rem;
  }
  
  .tag-badge {
    display: inline-block;
    padding: 5px 12px;
    background-color: #f0f5f9;
    color: #131d45;
    font-size: 0.8rem;
    border-radius: 20px;
    margin-right: 8px;
    margin-bottom: 8px;
  }
  
  .integration-footer {
    margin-top: auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  
  .integration-tags {
    display: flex;
    flex-wrap: wrap;
    margin-bottom: 15px;
  }
  
  .btn-interested {
    white-space: nowrap;
    padding: 8px 16px;
    border-radius: 6px;
    font-weight: 500;
    font-size: 0.9rem;
    transition: all 0.2s;
  }
  
  .btn-interested:hover {
    transform: translateY(-2px);
  }

  /* Modal Styles */
  #interestFormModal .modal-content {
    border: none;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  }
  
  #interestFormModal .modal-header {
    border-bottom: 1px solid #f3f3f3;
    padding: 20px 24px;
    border-top-left-radius: 16px;
    border-top-right-radius: 16px;
  }
  
  #interestFormModal .modal-title {
    font-weight: 600;
    color: #333;
    font-size: 1.4rem;
  }
  
  #interestFormModal .modal-body {
    padding: 24px;
  }
  
  #interestFormModal .form-label {
    font-weight: 500;
    margin-bottom: 8px;
    color: #555;
  }
  
  #interestFormModal .form-control {
    padding: 12px 16px;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    transition: all 0.3s;
  }
  
  #interestFormModal .form-control:focus {
    border-color: #7e57ff;
    box-shadow: 0 0 0 3px rgba(126, 87, 255, 0.1);
  }
  
  #interestFormModal textarea.form-control {
    min-height: 100px;
  }
  
  #interestFormModal .modal-footer {
    border-top: none;
    padding: 0 24px 24px;
    justify-content: flex-end;
  }
  
  #interestFormModal .btn-primary {
    background-color: #7e57ff;
    border-color: #7e57ff;
    padding: 10px 24px;
    font-weight: 500;
    border-radius: 8px;
  }
  
  #interestFormModal .btn-primary:hover {
    background-color: #6a46e5;
    border-color: #6a46e5;
  }
  
  #interestFormModal .btn-secondary {
    color: #555;
    background-color: #f1f1f1;
    border-color: #f1f1f1;
    padding: 10px 24px;
    font-weight: 500;
    border-radius: 8px;
  }
  
  #interestFormModal .btn-secondary:hover {
    background-color: #e5e5e5;
    border-color: #e5e5e5;
  }
  
  #thankYouModal .modal-content {
    border: none;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  }
  
  #thankYouModal .modal-header {
    border-bottom: 1px solid #f3f3f3;
    padding: 20px 24px;
  }
  
  #thankYouModal .modal-body {
    padding: 32px 24px;
  }
  
  #thankYouModal .text-success {
    color: #4caf50 !important;
  }
</style>

<div class="tab-pane fade" id="marketplace-tab">
  <div class="card marketplace-card p-0">
    <div class="card-body p-0">
      <section id="marketplace-header" class="text-muted py-5 position-relative header-section">  
        <div class="container py-4">
          <!-- Header -->
          <div class="text-center mb-5">
            <h1 class="display-4 fw-bold mb-4">CauseCircle Marketplace</h1>
            <p class="mx-auto mb-5" style="max-width: 800px;">
              Explore integrations that help your nonprofit do more. CauseCircle is building powerful connections with tools you already use â€” let us know what you'd like to see next.
            </p>
            
            <!-- Search bar -->
            <div class="row justify-content-center">
              <div class="col-lg-6">
                <div class="search-bar">
                  <button id="integration-search-btn" type="button">
                    <i class="bi bi-search"></i>
                  </button>
                  <input
                    id="integration-search"
                    type="text"
                    placeholder="Search integrations"
                    aria-label="Search"
                    class="form-control"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Featured integrations section with carousel -->
      <section class="py-5 overlap-section">
        <div class="container">
          <div id="integrationsCarousel" class="carousel slide position-relative" data-bs-ride="carousel">
            <div class="carousel-inner">
              {{ each marketplace_integrations as integration where integration.featured = 1}}
                {{ if {integration._index} % 2 == 0 }}
                  <div class="carousel-item {{ if {integration._index} == 0 }}active{{ /if }}">
                    <div class="row">
                {{ /if }}

                      <div class="col-md-6">
                        <div class="card p-4">
                          <div class="d-flex justify-content-between align-items-start mb-3">
                            <img src="{{ integration.logo.getImage() }}" alt="{{ integration.name }} Logo" class="img-fluid" style="max-height: 50px;">
                            {{ if {integration.featured} }}
                            <span class="featured-badge">
                              <i class="bi bi-star-fill me-1"></i> Featured
                            </span>
                            {{ /if }}
                          </div>
                          <h4>{{ integration.title }}</h4>
                          <div class="mb-4">
                            {{ integration.description }}
                          </div>
                          <div class="mt-auto d-flex flex-wrap gap-2">
                            {{if {integration.integration_tags} }}
                            {{ each integration_tags as tag where find_in_set(tag.zuid, '{integration.integration_tags}') }}
                            <span class="category-badge px-3 py-1">{{ tag.name }}</span>
                            {{ /each }}
                            {{ /if }}
                          </div>
                        </div>
                      </div>
                {{ if {integration._index} % 2 == 1 }}
                    </div> <!-- /.row -->
                  </div> <!-- /.carousel-item -->
                {{ /if }}
              {{ /each }}
            </div>

          </div>
          <!-- Carousel Controls -->
          <button class="carousel-control-prev" type="button" data-bs-target="#integrationsCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#integrationsCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </section>

      <!-- Categories and All Integrations Section -->
      <section class="py-5">
        <div class="container">
          <div class="row">
            <!-- Categories Sidebar -->
            <div class="col-lg-3">
              <h4 class="mb-4">Categories</h4>
              <ul class="categories-list">
                <li><a href="#" class="category-filter" data-category="all">All</a></li>
                {{each integration_tags as category}}
                <li><a href="#" class="category-filter" data-category="{{category.name}}">{{category.name}}</a></li>
                {{/each}}
              </ul>
            </div>
            
            <!-- Integrations List -->
            <div class="col-lg-9">
              <h4 class="mb-4">All integrations</h4>
              <div id="integrations-container">
                <!-- Dynamic integration cards will be loaded here -->
              </div>
              <div class="text-center mt-4">
                <button id="load-more-btn" class="btn btn-primary px-4 py-2" style="display: none;">Load More Integrations</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Interest Form Modal -->
      <div class="modal fade" id="interestFormModal" tabindex="-1" aria-labelledby="interestFormModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="interestFormModalLabel">Express Interest</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="integration-info mb-4 d-flex align-items-center">
                <div class="integration-logo-small me-3">
                  <img src="" id="modalIntegrationLogo" alt="Integration Logo" class="img-fluid" style="max-width: 60px; max-height: 60px;">
                </div>
                <div>
                  <h6 class="mb-1" id="modalIntegrationTitle"></h6>
                  <p class="text-muted mb-0 small">Fill out the form below to express your interest</p>
                </div>
              </div>
              
              <!-- Hidden iframe to handle form submission without page redirect -->
              <iframe name="hiddenFrame" id="hiddenFrame" style="display:none"></iframe>
              
              <form id="zohoInterestForm" action="https://forms.zohopublic.com/zestyio/form/MarketplaceForm/formperma/lWQvyLBd9e9zJs45mARYXI0rDN8lrqvlq_m6UuSmAqc/htmlRecords/submit" method="POST" enctype="multipart/form-data" target="hiddenFrame">
                <input type="hidden" name="zf_referrer_name" value="CauseCircle Marketplace">
                <input type="hidden" name="zf_redirect_url" value="">
                <input type="hidden" name="zc_gad" value="">
                
                <input type="hidden" id="integrationId" name="integrationId" value="">
                <input type="hidden" id="integrationTitle" name="IntegrationName" value="">
                
                <div class="mb-3">
                  <label for="userName" class="form-label">Name</label>
                  <input type="text" class="form-control" id="userName" name="SingleLine" required placeholder="Your full name">
                </div>
                
                <div class="mb-3">
                  <label for="userEmail" class="form-label">Email</label>
                  <input type="email" class="form-control" id="userEmail" name="SingleLine1" required placeholder="Your email address">
                </div>
                
                <div class="mb-3">
                  <label for="userOrganization" class="form-label">Organization Name</label>
                  <input type="text" class="form-control" id="userOrganization" name="SingleLine2" placeholder="Your organization">
                </div>
                
                <div class="mb-3">
                  <label for="userNote" class="form-label">Note</label>
                  <textarea class="form-control" id="userNote" name="SingleLine3" rows="3" required placeholder="Any specific questions or requirements?"></textarea>
                </div>
                
                <div class="mt-4 d-flex justify-content-end">
                  <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-primary" id="submitInterestBtn">
                    <span class="spinner-border spinner-border-sm d-none" id="submitSpinner" role="status" aria-hidden="true"></span>
                    Submit
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Thank You Modal -->
      <div class="modal fade" id="thankYouModal" tabindex="-1" aria-labelledby="thankYouModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="thankYouModalLabel">Request Received</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="text-center py-4">
                <div class="mb-3">
                  <i class="bi bi-check-circle-fill text-success" style="font-size: 4rem;"></i>
                </div>
                <h4 class="mb-3" style="font-weight: 600;">Thank you for your interest!</h4>
                <p class="mb-4" style="color: #666; max-width: 85%; margin: 0 auto;">We've received your request and will connect you with the integration provider shortly.</p>
                
                <div class="d-flex align-items-center justify-content-center mb-4 p-3" style="background-color: #f8f9fa; border-radius: 10px;">
                  <div class="me-3">
                    <img src="" id="thankYouIntegrationLogo" alt="Integration Logo" class="img-fluid" style="max-width: 50px; max-height: 50px;">
                  </div>
                  <div class="text-start">
                    <strong id="thankYouIntegrationTitle"></strong>
                    <div class="small text-muted">Integration Provider</div>
                  </div>
                </div>
                
                <div>
                  <button type="button" class="btn btn-primary px-4 py-2" data-bs-dismiss="modal" style="min-width: 120px;">Done</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- prettier-ignore -->
      {{include /components/global/faqs_section.html}}

      <script type="module"> 
        const integrationData = {
            integrations: [
                {{ each marketplace_integrations as integration }}
                {{ integration.toJSON(2) }}
                {{ integration._arraycomma }}
                {{ /each }}
            ]
        };

        $(document).ready(function() {
          // Try to get user data from localStorage
          let userData = null;
          let userEmail = '';
          let userName = '';
          let userOrganization = '';
          
          try {
            userData = JSON.parse(localStorage.getItem('zestyUser'));
            if (userData) {
              userEmail = userData?.email || '';
              userName = (userData?.first_name || '') + ' ' + (userData?.last_name || '');
              userName = userName.trim();
              userOrganization = userData?.organization || '';
            }
          } catch (e) {
            console.error('User data not available or invalid');
          }

          // Initialize the carousel
          let carousel = new bootstrap.Carousel(document.getElementById('integrationsCarousel'), {
              interval: 5000,  // Change slides every 5 seconds
              wrap: true       // Continuous loop
          });
            
          // Pagination variables
          const itemsPerPage = 4;
          let currentPage = 1;
          let filteredItems = [];
            
          // Render all integrations on page load
          renderIntegrations('all');
            
          // Set first category as active
          $('.categories-list a:first').addClass('active-category');
            
          // Filter categories when clicked
          $('.category-filter').on('click', function(e) {
              e.preventDefault();
              $('.category-filter').removeClass('active-category');
              $(this).addClass('active-category');
                
              const category = $(this).data('category');
              currentPage = 1; // Reset to first page on category change
              renderIntegrations(category);
          });
            
          // Load more button handler
          $('#load-more-btn').on('click', function() {
              currentPage++;
              const currentCategory = $('.category-filter.active-category').data('category');
              renderIntegrationPage(currentCategory);
          });
            
          // Store integration info for thank you modal
          let currentIntegrationTitle = '';
          let currentIntegrationLogo = '';
          
          // Handle "I'm Interested" button clicks
          $(document).on('click', '.btn-interested', function(e) {
              e.preventDefault();
                
              const integrationId = $(this).data('integration-id');
              const integrationTitle = $(this).data('integration-title');
              
              // Store current integration info
              currentIntegrationTitle = integrationTitle;
              
              // Set hidden fields and default values in the form
              $('#integrationId').val(integrationId);
              $('#integrationTitle').val(integrationTitle);
              $('#modalIntegrationTitle').text(integrationTitle);
              
              // Set the logo in the modal if available
              const card = $(this).closest('.integration-card');
              const logoSrc = card.find('.integration-logo img').attr('src');
              $('#modalIntegrationLogo').attr('src', logoSrc);
              currentIntegrationLogo = logoSrc;
              
              // Pre-populate the form with user data if available
              if (userName) {
                  $('#userName').val(userName);
              }
              
              if (userEmail) {
                  $('#userEmail').val(userEmail);
              }
              
              if (userOrganization) {
                  $('#userOrganization').val(userOrganization);
              }
              
              // Set default note with integration name
              $('#userNote').val(`I'm interested in learning more about ${integrationTitle}.`);
              
              // Show the modal
              const interestModal = new bootstrap.Modal(document.getElementById('interestFormModal'));
              interestModal.show();
          });
          
          // Handle form submission
          $('#zohoInterestForm').on('submit', function() {
              // Show spinner on button
              $('#submitSpinner').removeClass('d-none');
              $('#submitInterestBtn').prop('disabled', true);
              
              // Set thank you modal content now, before form submits
              $('#thankYouIntegrationTitle').text(currentIntegrationTitle);
              $('#thankYouIntegrationLogo').attr('src', currentIntegrationLogo);
              
              // Use setTimeout to simulate form submission time and show thank you modal
              setTimeout(function() {
                  // Hide spinner
                  $('#submitSpinner').addClass('d-none');
                  $('#submitInterestBtn').prop('disabled', false);
                  
                  // Close the form modal
                  const interestModal = bootstrap.Modal.getInstance(document.getElementById('interestFormModal'));
                  interestModal.hide();
                  
                  // Show thank you modal
                  setTimeout(() => {
                      const thankYouModal = new bootstrap.Modal(document.getElementById('thankYouModal'));
                      thankYouModal.show();
                      
                      // Reset the form
                      $('#zohoInterestForm')[0].reset();
                  }, 500);
              }, 1500); // Small delay to show the spinner
              
              // Allow the form to submit normally to hidden iframe
              return true;
          });
          
          // Function to handle search operation
          function performSearch() {
              const searchTerm = $('#integration-search').val().toLowerCase().trim();
              
              if (searchTerm.length === 0) {
                  // If search is cleared, show based on current category
                  const currentCategory = $('.category-filter.active-category').data('category');
                  renderIntegrations(currentCategory);
                  return;
              }
              
              const container = $('#integrations-container');
              container.empty();
              
              // Filter integrations by search term
              filteredItems = integrationData.integrations.filter(integration => {
                  if (!integration) return false;
                  
                  // Search in title and description
                  const titleMatch = integration.title && integration.title.toLowerCase().includes(searchTerm);
                  const descMatch = integration.description && integration.description.toLowerCase().includes(searchTerm);
                  
                  // Search in tags
                  let tagMatch = false;
                  if (integration.integration_tags && integration.integration_tags.data) {
                      tagMatch = integration.integration_tags.data.some(
                          tag => tag.name && tag.name.toLowerCase().includes(searchTerm)
                      );
                  }
                  
                  return titleMatch || descMatch || tagMatch;
              });
              
              // Reset pagination
              currentPage = 1;
              
              // Show no results message
              if (filteredItems.length === 0) {
                  container.html('<p>No integrations match your search</p>');
                  $('#load-more-btn').hide();
              } else {
                  // Render first page of results
                  renderIntegrationPage('search');
              }
              
              // Scroll to the integrations list
              $('html, body').animate({
                  scrollTop: $('#integrations-container').offset().top - 100
              }, 500);
          }

          // Function to render integrations based on selected category
          function renderIntegrations(category) {
              const container = $('#integrations-container');
              container.empty();
              
              if (!integrationData || !integrationData.integrations || !Array.isArray(integrationData.integrations)) {
                  container.html('<p>No integrations available</p>');
                  $('#load-more-btn').hide();
                  return;
              }
              
              // Filter integrations by category
              filteredItems = integrationData.integrations.filter(integration => {
                  if (!integration) return false;
                  
                  // For "all" category, include all integrations
                  if (category === 'all') return true;
                  
                  // Otherwise, check if integration has the selected category tag
                  return integration.integration_tags && 
                         integration.integration_tags.data && 
                         integration.integration_tags.data.some(tag => tag.name === category);
              });
              
              // Reset pagination
              currentPage = 1;
              
              // Render first page
              renderIntegrationPage(category);
          }
            
          // Function to render a specific page of integrations
          function renderIntegrationPage(category) {
              const container = $('#integrations-container');
                
              // Calculate items for current page
              const startIndex = (currentPage - 1) * itemsPerPage;
              const endIndex = Math.min(startIndex + itemsPerPage, filteredItems.length);
              const itemsToRender = filteredItems.slice(startIndex, endIndex);
                
              // Clear container on first page
              if (currentPage === 1) {
                  container.empty();
              }
                
              // No items to display
              if (itemsToRender.length === 0 && currentPage === 1) {
                  container.html('<p>No integrations found for this category</p>');
                  $('#load-more-btn').hide();
                  return;
              }
                
              // Render items
              itemsToRender.forEach(integration => {
                  // Get logo URL
                  let logoUrl = 'https://via.placeholder.com/120x50';
                  if (integration.logo && integration.logo.data && integration.logo.data.length > 0) {
                      logoUrl = integration.logo.data[0].url;
                  }
                      
                  // Get integration ID
                  const integrationId = integration.meta ? integration.meta.zuid : `integration-${Math.random().toString(36).substr(2, 9)}`;
                      
                  // Create integration card HTML
                  const card = `
                      <div class="integration-card">
                          <div class="integration-logo">
                              <img src="${logoUrl}" alt="${integration.title} Logo" class="img-fluid">
                          </div>
                          <div class="integration-content">
                              <h3>${integration.title}</h3>
                              <p>${integration.description}</p>
                              <div class="integration-tags">
                                  ${renderTags(integration)}
                              </div>
                              <div class="integration-footer">
                                  <button class="btn btn-secondary btn-interested" 
                                          data-integration-id="${integrationId}"
                                          data-integration-title="${integration.title}">
                                      I'm Interested
                                  </button>
                              </div>
                          </div>
                      </div>
                  `;
                      
                  container.append(card);
              });
                
              // Show/hide load more button
              if (endIndex < filteredItems.length) {
                  $('#load-more-btn').show();
              } else {
                  $('#load-more-btn').hide();
              }
          }
            
          // Function to render tags for an integration
          function renderTags(integration) {
              if (!integration.integration_tags || !integration.integration_tags.data) {
                  return '';
              }
                
              return integration.integration_tags.data
                  .map(tag => `<span class="tag-badge">${tag.name}</span>`)
                  .join('');
          }
            
          // Initialize search functionality - input event
          $('#integration-search').on('input', function() {
              // Check if search field is empty, if so restore category view
              if ($(this).val().trim() === '') {
                  const currentCategory = $('.category-filter.active-category').data('category');
                  renderIntegrations(currentCategory);
              }
          });
            
          // Handle Enter key press in search input
          $('#integration-search').on('keypress', function(e) {
              if (e.which === 13) { // Enter key code
                  e.preventDefault();
                  performSearch();
              }
          });
            
          // Hook up search button click
          $('#integration-search-btn').on('click', function() {
              performSearch();
          });
        });
      </script>
    </div>
  </div>
</div> 