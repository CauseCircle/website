{{$slug = {request.pathPart(2)} }}
<!--prettier-ignore-->
{{$zuid = }}
<!--prettier-ignore-->
{{each non_profits as npo where npo._path_part like '{$slug}' }}
{{$zuid = {npo._zuid} }}
<html lang="en">
  <head>
    <title>{{npo.name}} invited you to Join their CauseCircle!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Add required stylesheets -->
    <link href="/styles/bootstrap.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap"
      rel="stylesheet"
    />

    <style>
      .left-side {
        width: 600px;
        background-color: #fff;
        transition: width 0.3s ease;
      }
      @media (max-width: 767.98px) {
        .left-side {
          width: 100%;
        }
      }
      .right-side {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 4rem;
      }
      .login-btn {
        width: 7.625rem;
        height: 2.5rem;
        border-radius: 10px;
        border: 1px solid #e1e4ea;
        box-shadow: 0px 1px 2px 0px #0a0d1408;
        background-color: #fff;
        transition: box-shadow 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .login-btn:hover {
        box-shadow: 0px 4px 8px 0px #0a0d1420;
        background-color: #f5f7fa;
      }

      @media (max-width: 1199px) {
        .left-side {
          width: 100%;
        }
      }

      .section-title p,
      .section-title {
        font-size: 2rem;
        font-weight: 500;
        text-align: center;
      }
      .hero-description p,
      .hero-description {
        font-size: 1.125rem;
        font-weight: 400;
        text-align: center;
        color: var(--bs-gray-500);
        max-width: 53.125rem;
      }

      .left-side-full {
        width: 100% !important;
      }
    </style>

<script>
  <!-- prettier-ignore -->
  {{include /auth/facebook.js}}
</script>

    <!-- Firebase Scripts -->
    <script
      defer
      src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"
    ></script>
    <script
      defer
      src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"
    ></script>
    <script
      defer
      src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"
    ></script>

    <script type="module" src="/auth/firebase-config.js"></script>

    <!-- Bootstrap Bundle -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <!-- Include base auth -->
    {{include /auth/base.html}}
  </head>
  <body>
    <div class="d-flex flex-column flex-md-row" style="height: 100vh; background-color: #f5f7fa">
      <div class="left-side">
        <div id="login-section" class="d-none d-flex flex-column h-100 pt-5 pt-md-0 min-vh-100">
          <div
            class="d-flex flex-column justify-content-center align-items-center flex-grow-1 px-3"
          >
            <div>
              <img
                src="{{npo.logo.getImage()}}"
                alt="{{npo.name}}"
                style="max-width: 200px"
              />
            </div>
            <div>
              <p id="login-title" class="text-center fs-4 fw-medium mb-0 mt-4">
                Get Started with {{npo.name}}
              </p>
              <div id="login-description" class="text-center fs-6 text-muted">
                Continue by selecting your preferred login method.
              </div>
            </div>
            <div class="login-button-container d-flex gap-2 mt-4">
              <button
            type="button"
            class="login-btn btn btn-light"
            id="google-signin-btn"
          >
            <svg width="20" height="20" viewBox="0 0 24 24">
              <path
                fill="#EA4335"
                d="M5.26620003,9.76452941 C6.19878754,6.93863203 8.85444915,4.90909091 12,4.90909091 C13.6909091,4.90909091 15.2181818,5.50909091 16.4181818,6.49090909 L19.9090909,3 C17.7818182,1.14545455 15.0545455,0 12,0 C7.27006974,0 3.1977497,2.69829785 1.23999023,6.65002441 L5.26620003,9.76452941 Z"
              />
              <path
                fill="#34A853"
                d="M16.0407269,18.0125889 C14.9509167,18.7163016 13.5660892,19.0909091 12,19.0909091 C8.86648613,19.0909091 6.21911939,17.076871 5.27698177,14.2678769 L1.23746264,17.3349879 C3.19279051,21.2936293 7.26500293,24 12,24 C14.9328362,24 17.7353462,22.9573905 19.834192,20.9995801 L16.0407269,18.0125889 Z"
              />
              <path
                fill="#4A90E2"
                d="M19.834192,20.9995801 C22.0291676,18.9520994 23.4545455,15.903663 23.4545455,12 C23.4545455,11.2909091 23.3454545,10.5272727 23.1818182,9.81818182 L12,9.81818182 L12,14.4545455 L18.4363636,14.4545455 C18.1187732,16.013626 17.2662994,17.2212117 16.0407269,18.0125889 L19.834192,20.9995801 Z"
              />
              <path
                fill="#FBBC05"
                d="M5.27698177,14.2678769 C5.03832634,13.556323 4.90909091,12.7937589 4.90909091,12 C4.90909091,11.2182781 5.03443647,10.4668121 5.26620003,9.76452941 L1.23999023,6.65002441 C0.43658717,8.26043162 0,10.0753848 0,12 C0,13.9195484 0.444780743,15.7301709 1.23746264,17.3349879 L5.27698177,14.2678769 Z"
              />
            </svg>
          </button>
          <button
            type="button"
            class="login-btn btn btn-light"
            id="continue-with-fb-btn"
          >
            <i
              class="bi bi-facebook"
              style="font-size: 20px; color: #448afd"
            ></i>
          </button>
            </div>
          </div>
          <div class="d-flex justify-content-between align-items-center p-4">
            <p class="fs-6 text-muted mb-0">Â© 2024 CauseCircle</p>
            <span class="text-muted">
              <i class="bi bi-globe text-muted" style="font-size: 20px"></i>
              ENG
            </span>
          </div>
        </div>

        <div id="accept-invite-section" class="d-flex flex-column h-100 pt-5 pt-md-0">
          <div
            class="d-flex flex-column justify-content-center align-items-center flex-grow-1 px-3 px-md-5"
          >
            <div>
              <img
                src="{{npo.logo.getImage()}}"
                alt="{{npo.name}}"
                style="max-width: 200px"
              />
            </div>
            <div>
              <p id="login-title" class="text-center fs-4 fw-medium mb-0 mt-4">
                {{npo.name}} has invited you to join CauseCircle
              </p>
              <div id="login-description" class="text-center fs-6 text-muted">
                CauseCircle is a platform where you can share and amplify
                stories about causes you care about to a community that cares.
              </div>
              <button class="btn btn-primary w-100 mt-4">Accept Invite</button>
            </div>
          </div>
        </div>
      </div>
      <!--Use Cases section-->
      <section
        id="use-cases-section"
        class="right-side d-flex p-lg-3 container py-5"
      >
        <div class="d-flex flex-column gap-3">
          <p class="section-title mb-0">What is CauseCircle?</p>
          <div class="hero-description mx-auto">
            <p>Empower your community with stories that inspire action.</p>
          </div>
          <div class="row pt-3 row-gap-5">
            <!--prettier-ignore-->
            {{ $home_use_cases = {homepage.first().use_cases} }}
            <!--prettier-ignore-->
            {{each use_cases as use_case where FIND_IN_SET (use_case.zuid, '{$home_use_cases}') }}
            <div class="col-12 col-sm-6 col-md-4">
              <!--prettier-ignore-->
              {{ include /components/global/usecases_card.html }}
            </div>
            {{/each}}
          </div>
          <div class="d-flex justify-content-center pt-3 d-none">
            <button class="btn btn-primary mx-auto">Accept Invite</button>
          </div>
        </div>
      </section>
    </div>

    <!-- Include login prompt modal with updated content -->
    <div class="modal fade" id="loginPromptModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-sm" style="border-radius: 16px;">
          <div class="modal-body p-5">
            <div class="d-flex flex-column align-items-center text-center">
              <!-- Loading spinner -->
              <div class="spinner-border text-primary mb-4" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Loading...</span>
              </div>
              <!-- Message -->
              <h5 class="mb-3" style="color: #2C3E50; font-weight: 500;">Please wait</h5>
              <p class="text-muted mb-0" style="font-size: 1rem;">
                Your account is being created...
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <style>
      #loginPromptModal .modal-content {
        background-color: #ffffff;
        border: none;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      #loginPromptModal .spinner-border {
        color: #0d6efd;
      }

      #loginPromptModal .modal-body { 
        padding: 2.5rem !important;
      }

      /* Fade in animation for the modal content */
      #loginPromptModal .modal-content {
        animation: fadeIn 0.3s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>

    <!-- Add required scripts -->
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>


    

    <!-- Move these event listeners inside the DOMContentLoaded event -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        document
          .getElementById("google-signin-btn")
          .addEventListener("click", function () {
            localStorage.setItem("npoZuidToFollow", "{{$zuid}}");
            // Show modal before sign in
            const loginModal = new bootstrap.Modal(
              document.getElementById("loginPromptModal")
            );
            loginModal.show();
            signInWithGoogle();
          });
        document
          .getElementById("continue-with-fb-btn")
          .addEventListener("click", function () {
            localStorage.setItem("npoZuidToFollow", "{{$zuid}}");
            // Show modal before sign in
            const loginModal = new bootstrap.Modal(
              document.getElementById("loginPromptModal")
            );
            loginModal.show();
            console.log('from custom, ', localStorage.getItem('npoZuidToFollow'))
            signInWithFacebook();
          });

        // Add check for modal state
        const shouldShowModal = localStorage.getItem("showModalAfterSignIn");
        if (shouldShowModal) {
          const loginModal = new bootstrap.Modal(
            document.getElementById("loginPromptModal")
          );
          loginModal.show();
          localStorage.removeItem("showModalAfterSignIn");
        }

        // Clear modal state when page is closed
        window.addEventListener("beforeunload", function() {
          localStorage.removeItem("showModalAfterSignIn");
        });
      });
    </script>

    <script>
      const zuid = "{{$zuid}}";

      // Update the handleAcceptInvite function
      function handleAcceptInvite() {
        document
          .getElementById("accept-invite-section")
          .classList.add("d-none");
        document.getElementById("login-section").classList.remove("d-none");

        // Add full width class to left side
        document.querySelector(".left-side").classList.add("left-side-full");

        // Update the right side section classes to be hidden on all screen sizes
        const useCasesSection = document.getElementById("use-cases-section");
        useCasesSection.classList.remove("d-lg-flex");
        useCasesSection.classList.add("d-none");
      }

      // Add click event listeners to both Accept Invite buttons
      document.addEventListener("DOMContentLoaded", function () {
        const acceptInviteButtons = document.querySelectorAll(".btn-primary");
        acceptInviteButtons.forEach((button) => {
          button.addEventListener("click", handleAcceptInvite);
        });
      });
    </script>
  </body>
</html>
{{/each}}
