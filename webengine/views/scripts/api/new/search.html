<script type="module">
  const BASE_URL = "https://api.causecircle.org";
  
  import { QueryObserver, MutationObserver } from 'https://esm.sh/@tanstack/query-core@5.90.2';

  // ==================== SEARCH QUERIES ====================
  // TanStack Query wrappers for search operations

  /**
   * Query for searching NPOs
   * @param {string} query - Search query
   * @returns {QueryObserver}
   */
  window.createSearchNposQuery = (query) => {
    return new QueryObserver(window.queryClient, {
      queryKey: ['search', 'npos', query],
      queryFn: () => $.getJSON(`${BASE_URL}/npos/search?search=${encodeURIComponent(query)}`),
      staleTime: 0, // Always stale - search results should be fresh
      cacheTime: 5 * 60 * 1000, // Keep in cache for 5 minutes
      enabled: !!query && query.length > 0,
    });
  };

  /**
   * Query for searching causes
   * @param {string} query - Search query
   * @returns {QueryObserver}
   */
  window.createSearchCausesQuery = (query) => {
    return new QueryObserver(window.queryClient, {
      queryKey: ['search', 'causes', query],
      queryFn: () => $.getJSON(`{{ $base_url }}mobileapp/causes.json?zpw=causecircle&search=${encodeURIComponent(query)}`),
      staleTime: 0, // Always stale - search results should be fresh
      cacheTime: 5 * 60 * 1000, // Keep in cache for 5 minutes
      enabled: !!query && query.length > 0,
    });
  };

  /**
   * Query for searching stories
   * @param {string} query - Search query
   * @returns {QueryObserver}
   */
  window.createSearchStoriesQuery = (query) => {
    return new QueryObserver(window.queryClient, {
      queryKey: ['search', 'stories', query],
      queryFn: () => $.getJSON(`{{ $base_url }}mobileapp/stories.json?zpw=causecircle&search=${encodeURIComponent(query)}`),
      staleTime: 0, // Always stale - search results should be fresh
      cacheTime: 5 * 60 * 1000, // Keep in cache for 5 minutes
      enabled: !!query && query.length > 0,
    });
  };
</script>
