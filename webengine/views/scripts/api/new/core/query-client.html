<script type="module">
  // ==================== TANSTACK QUERY CLIENT ====================
  // Initialize the global QueryClient for caching and state management

  import { QueryClient } from 'https://esm.sh/@tanstack/query-core@5.90.2';

  // Create and expose QueryClient globally
  window.queryClient = new QueryClient({
    defaultOptions: {
      queries: {
        staleTime: 5 * 60 * 1000,        // 5 minutes - data is fresh for 5 minutes
        cacheTime: 10 * 60 * 1000,       // 10 minutes - unused data is garbage collected after 10 minutes
        refetchOnWindowFocus: true,       // Refetch when user returns to tab
        refetchOnReconnect: true,         // Refetch when internet reconnects
        retry: 3,                         // Retry failed requests 3 times
        retryDelay: attemptIndex => Math.min(1000 * 2 ** attemptIndex, 30000), // Exponential backoff
      },
      mutations: {
        retry: 1,                         // Retry mutations once on failure
        onError: (error) => {
          console.error('Mutation failed:', error);
          // You can add global error handling here (e.g., show toast notification)
        },
      },
    },
  });
</script>
