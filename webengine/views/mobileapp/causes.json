{{$skip = 0 }}
{{$limit = 0 }}
{{$totalNpo = 0}}
{{$sort = desc}}
{{$filter = "" }}
{{$featured = ""}}

{{if {request.queryParam(skip)} }}
{{$skip = {request.queryParam(skip)} }}
{{else}}
{{$skip = 0}}
{{end-if}}

{{if {request.queryParam(limit)} }}
{{$limit = {request.queryParam(limit)} }}
{{else}}
{{$limit = 10}}
{{end-if}}

{{if {request.queryParam(sort)} &&  {request.queryParam(sort)} === 'asc'}}
{{$sort = asc }}
{{else}}
{{$sort = desc }}
{{end-if}}

{{if {request.queryParam(filter)} }}
{{$filter = "%{request.queryParam(filter)}%" }}
{{else}}
{{$filter = "%%" }}
{{end-if}}

(** {{if {request.queryParam(featured)} && {request.queryParam(featured)} === 'true' }} **)
{{if true}}
{{$featured = AND cause.featured = 1 }}
{{else}}
{{$featured = "" }}
{{end-if}}

{{ each causes as cause }}
{{$totalCauses = {cause._num} }}
{{/each}}
{
    "data": [
        {{ each causes as cause WHERE cause.title LIKE {$filter} {$featured} limit {$skip}, {$limit} }}
        {
            "title": "{{cause.title}}",
            "description": "{{cause.description.escapeForJs()}}",
            "short_description": "{{cause.short_description.escapeForJs()}}",
            "image": "{{cause.image.getImage()}}",
            "sort_order": "{{cause.sort_order}}",
            "zuid": "{{cause._zuid}}",
            "href": "{{cause.path_full.escapeForJs()}}",
            "featured": "{{cause.featured}}"
        }{{cause._arraycomma}}
        {{/each}}
    ],
    "meta": {
        "skip": {{$skip}},
        "limit": {{$limit}},
        "page": {{math({$skip} / {$limit} + 1)}},
        "pages": {{ math(round({$totalCauses} / {$limit})) }},
        "totalItems": {{$totalCauses}},
        "sort": "{{$sort}}",
        "filter": {{$filter}}
    }
}